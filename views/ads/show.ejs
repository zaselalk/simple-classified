<% layout('layouts/boilerplate')%>
<link rel="stylesheet" href="/stylesheets/stars.css" />

<!-- ======= Ad Title Section ======= -->
<div class="ad-title-section text-center py-3 mb-4 bg-light shadow-sm rounded">
  <h1 class="display-5 text-dark mb-0"><%= ad.title %></h1>
  <p class="text-muted mb-0">üìç <%= ad.location %></p>
</div>

<div class="container">
  <div class="row">
    <!-- ======= Left Side: Images and Details ======= -->
    <div class="col-md-8">
      <div class="card mb-4 shadow-sm border-0">
        <% if(ad.images.length){ %>
        <div id="adCarousel" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner">
            <% ad.images.forEach((img, i) => { %>
            <div class="carousel-item <%= i === 0 ? 'active' : ''%>">
              <img
                src="<%= img.url%>"
                class="d-block w-100 rounded"
                height="400px"
                alt="Ad image"
              />
            </div>
            <% }) %>
          </div>
          <% if(ad.images.length > 1) {%>
          <a
            class="carousel-control-prev"
            href="#adCarousel"
            role="button"
            data-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a
            class="carousel-control-next"
            href="#adCarousel"
            role="button"
            data-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
          <% } %>
        </div>
        <% }else{ %>
        <img
          class="img-fluid rounded"
          alt="No image"
          src="/Images/no-image.png"
        />
        <% } %>

        <!-- ======= Ad Description and Price ======= -->
        <div class="card-body">
          <h4 class="font-weight-bold mb-3">Description</h4>
          <p class="card-text"><%= ad.description %></p>
          <div class="price-highlight text-center my-4">
            <span
              class="badge badge-success p-3 px-4"
              style="font-size: 1.5rem"
            >
              üí∞ $<%= ad.price %>
            </span>
          </div>
        </div>

        <% if(currentUser && ad.author.equals(currentUser._id)) { %>
        <div class="card-body text-center">
          <a class="btn btn-info mx-1" href="/ads/<%= ad._id %>/edit">Edit</a>
          <form
            class="d-inline"
            action="/ads/<%= ad._id %>?_method=DELETE"
            method="POST"
          >
            <% if (csrfToken) { %>
            <input type="hidden" name="_csrf" value="<%= csrfToken %>" />
            <% } %>
            <button class="btn btn-danger mx-1">Delete</button>
          </form>
        </div>
        <% } %>
      </div>
    </div>

    <!-- ======= Right Side: Seller Details ======= -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 seller-details p-3">
        <h5 class="text-center text-secondary mb-3">Seller Details</h5>
        <div class="text-center">
          <img
            src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
            class="rounded-circle mb-2"
            width="90"
            height="90"
            alt="Seller avatar"
          />
          <h6 class="mb-0"><%= ad.author.username %></h6>
          <p class="text-muted small">Member since 2024</p>
        </div>
        <div class="mt-3 text-center">
          <a
            href="/user/<%= ad.author._id %>"
            class="btn btn-outline-primary btn-sm"
          >
            View Profile
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
